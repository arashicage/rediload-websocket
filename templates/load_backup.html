<script type="text/javascript">
	function loadTest1() {
		jQuery.noConflict();
		$('#what').selectpicker('val', '01');
		document.getElementById('what').options[0].selected = true;
		document.getElementById('url').value = "130.9.1.22:6379";
		document.getElementById('core').value = "24";
		document.getElementById('worker').value = "100";
		document.getElementById('uid').value = "dzdz/oracle@dzdz_dev_11200";
		document.getElementById('sql').innerHTML = "select /*+ parallel(t,8) */ '01:'||fpdm||fphm key,kprq, skm, gfmc, gfsbh, gfdzdh, gfyhzh, xfmc, xfsbh, xfdzdh, xfyhzh, je, se, jshj, bz, skr, fhr, kpr, jqbh, kpjh,trunc((sysdate-kprq)*1440*60) expire from dzdz_fpxx_zzsfp";
		document.getElementById('fields').innerHTML = "key,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,expire";
		document.getElementById('fields').readOnly = false;
		document.getElementById('batch').value = "10000";
		$('#codepage').selectpicker('val', 'gbk');
		return false;
	}
	function loadTest2() {
		jQuery.noConflict();
		$('#what').selectpicker('val', '02');
		document.getElementById('what').options[1].selected = true;
		document.getElementById('url').value = "130.9.1.22:6379";
		document.getElementById('core').value = "24";
		document.getElementById('worker').value = "100";
		document.getElementById('uid').value = "dzdz/oracle@dzdz_dev_11200";
		document.getElementById('sql').innerHTML = "select /*+ parallel(t,8) */ '01:'||t.fpdm||t.fphm key,'h'||t.id,t.hwmc||'~~'||t.ggxh||'~~'||t.dw||'~~'||t.sl||'~~'||t.dj||'~~'||t.je||'~~'||t.slv||'~~'||t.se from dzdz_hwxx_zzsfp t where t.id<=7 order by fpdm,fphm,id";
		document.getElementById('fields').innerHTML = "key,field,value";
		document.getElementById('fields').readOnly = true;
		document.getElementById('batch').value = "10000";
		$('#codepage').selectpicker('val', 'gbk');
		return false;
	}
</script>
<script type="text/javascript">
	function optSelected() {
		var optVal = document.getElementById("what").value;
		console.log(optVal);
		if (optVal == "02") {
			document.getElementById('sql').placeholder = "select /*+ parallel(t,8) */ '01:'||t.fpdm||t.fphm key,'h'||t.id,t.hwmc||'~~'||t.ggxh||'~~'||t.dw||'~~'||t.sl||'~~'||t.dj||'~~'||t.je||'~~'||t.slv||'~~'||t.se from dzdz_hwxx_zzsfp t where t.id<=7 order by fpdm,fphm,id";
			document.getElementById('sql').innerHTML = "select /*+ parallel(t,8) */ '01:'||t.fpdm||t.fphm key,'h'||t.id,t.hwmc||'~~'||t.ggxh||'~~'||t.dw||'~~'||t.sl||'~~'||t.dj||'~~'||t.je||'~~'||t.slv||'~~'||t.se from dzdz_hwxx_zzsfp t where t.id<=7 order by fpdm,fphm,id";
			document.getElementById('fields').innerHTML = "key,field,value";
			document.getElementById('fields').readOnly = true;
		}
		if (optVal == "01") {
			document.getElementById('sql').placeholder = "select /*+ parallel(t,8) */ '01:'||fpdm||fphm key,kprq, skm, gfmc, gfsbh, gfdzdh, gfyhzh, xfmc, xfsbh, xfdzdh, xfyhzh, je, se, jshj, bz, skr, fhr, kpr, jqbh, kpjh,trunc((sysdate-kprq)*1440*60) expire from dzdz_fpxx_zzsfp";
			document.getElementById('sql').innerHTML = "select /*+ parallel(t,8) */ '01:'||fpdm||fphm key,kprq, skm, gfmc, gfsbh, gfdzdh, gfyhzh, xfmc, xfsbh, xfdzdh, xfyhzh, je, se, jshj, bz, skr, fhr, kpr, jqbh, kpjh,trunc((sysdate-kprq)*1440*60) expire from dzdz_fpxx_zzsfp";
			document.getElementById('fields').placeholder = "key,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,expire";
			document.getElementById('fields').innerHTML = "key,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,expire";
			document.getElementById('fields').readOnly = false;
		}
	}
	function checkInput() {
		var url = document.getElementById('url');
		var core = document.getElementById('core');
		var worker = document.getElementById('worker');
		var batch = document.getElementById('batch');
		var sql = document.getElementById('sql');
		var fields = document.getElementById('fields');
		var uid = document.getElementById('uid');
		if (url.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 redis 连接信息，请输入有效的 redis 连接信息。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		if (core.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 core，请输入有效的 core。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		if (worker.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 worker，请输入有效的 worker。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		if (batch.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 batch，请输入有效的 batch。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		if (sql.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 sql，请输入有效的 sql。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		if (fields.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 fields，请输入有效的 fields。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		if (uid.value.length == 0) {
			document.getElementById('warn').style.display = 'block';
			document.getElementById('alert').innerHTML = "您没有输入有效的 uid，请输入有效的 uid。";
			document.getElementById('alert').style.display = 'block';
			return false
		}
		loadredis();
	}
</script>
<script type="text/javascript">

	function showDefaults() {
		console.log("xxx");
		$('#defaults').toggle('hidden');
	}

	var intervalID;
	function keypress() {
		if (event.keyCode == 13) {
			checkInput();
		}
	}
	function loadredis() {
		$("#console").empty();
		var what = $("#what").val();
		var url = $("#url").val();
		var core = $("#core").val();
		var worker = $("#worker").val();
		var uid = $("#uid").val();
		var sql = $("#sql").val();
		var fields = $("#fields").val();
		var batch = $("#batch").val();
		var codepage = $("#codepage").val();
		var log = $("#log").val();
		console.log("what        :" + what);
		console.log("url         :" + url);
		console.log("core        :" + core);
		console.log("worker      :" + worker);
		console.log("uid         :" + uid);
		console.log("sql         :" + sql);
		console.log("fields      :" + fields);
		console.log("batch       :" + batch);
		console.log("codepage    :" + codepage);
		console.log("log         :" + log);
		var sock = null;
		var wsurl = "ws://" + window.location.host + "/load/ws?" + "what=" + what + "&" + "url=" + url + "&" + "core=" + core + "&" + "worker=" + worker + "&" + "uid=" + uid + "&" + "sql=" + sql + "&" + "fields=" + fields + "&" + "batch=" + batch + "&" + "codepage=" + codepage + "&" + "log=" + log;
		console.log("ws          :" + wsurl);
		console.log("====================================================以下为程序输出====================================================");
		console.log(" ");
		try {
			sock = new WebSocket(wsurl);
		} catch (e) {
			alert(e);
		}
		sock.onopen = function() {
			console.log("connected to" + wsurl);
			intervalID = setInterval(displayProcess, 1000);
		};
		sock.onerror = function(e) {
			console.log("err from connect" + e);
		};
		sock.onclose = function(e) {
			console.log("connection closed (" + e.code + ")");
		};
		sock.onmessage = function(e) {
			console.log("message received:" + e.data);
			var data = eval('(' + e.data + ')');
			if (data.type == "output") {
				$("#console").append(data.msg + "\n");
			} else if (data.type == "command") {
				$("#console").append("$" + data.msg + "\n");
			} else if (data.type == "completed") {
				$("#console").append("<strong>" + data.msg + "</strong>\n");
				clearInterval(intervalID);
				$('#waiting').empty();
			} else if (data.type == "error") {
				$("#console").append('<span style="color: red;">' + data.msg + '</span>\n');
				clearInterval(intervalID);
				$('#waiting').empty();
			}
			console.log($('#console')[0].scrollHeight);
			//            $("#console-wrap").css('max-height', $('#console')[0].scrollHeight + 200);
			$("#console").css('height', $('#console')[0].scrollHeight + 10);
		}
	}
	function displayProcess() {
		$('#waiting').append('.');
	}
</script>
<div class="container" style="margin-top: 40px;">
	<div id="formname" class="form-horizontal" role="form">
		<!--<div class="form-group">
				<label class="col-sm-2 control-label"><a href="/help"><span class="glyphicon glyphicon-book"></span>&nbsp;参数说明</a></label>
				<div class="col-sm-9">
						<div class="btn-group btn-group-justified" role="group" aria-label="...">
								<div class="btn-group" role="group">
										<button type="button" class="btn btn-default" onclick="loadTest1();">加载发票选项</button>
								</div>
								<div class="btn-group" role="group">
										<button type="button" class="btn btn-default" onclick="loadTest2();">加载货物选项</button>
								</div>
								<div class="btn-group" role="group">
										<button type="button" class="btn btn-default" onclick="showDefaults();">加载货物选项</button>
								</div>
						</div>
				</div>
		</div>-->
		<div class="form-group">
			<label class="col-sm-2 control-label" style="text-align: right"><em>发票类型</em></label>
			<div class="col-sm-3">
				<select id="fplx" name="fplx" class="selectpicker show-tick form-control" data-size="8">
					<option value="01">01-增值税专用发票</option>
					<option value="02">02-货物运输业专用发票</option>
					<option value="03">03-机动车销售统一发票</option>
					<option value="04">04-增值税普通发票</option>
					<option value="10">10-增值税普通发票（电子发票）</option>
					<option value="11">11-增值税普通发票（卷式发票）</option>
				</select>
			</div>
			<label class="col-sm-1 control-label"><em>数据类型</em></label>
			<div class="col-sm-3">
				<select id="what" name="what" class="selectpicker show-tick form-control" data-size="5" onchange="optSelected();">
					<option id="op01" name="op01" value="01">发票信息</option>
					<option id="op02" name="op02" value="02">货物信息</option>
				</select>
			</div>
			<label class="col-sm-2 control-label" style="text-align: center;font-weight:normal;"><a href="#" onclick="showDefaults();">查看默认选项</a></label>
		</div>

		<div id="defaults" hidden="hidden">

			<div class="form-group" >
				<label class="col-sm-2 control-label ">Core</label>
				
				<div class="col-sm-9 ">
					<input id="core" name="core" type="text" class="form-control" placeholder="32" value="32">
				</div>
			
			</div>		

			<div class="form-group">
				
				<label class="col-sm-2 control-label ">Worker</label>

				<div class="col-sm-9">
					<input id="worker" name="worker" type="text" class="form-control" placeholder="100" value="100 ">
				</div>
				
			</div>

			<div class="form-group">
				
				<label class="col-sm-2 control-label ">Batch</label>

				<div class="col-sm-9 ">
					<input id="batch" name="batch" type="text" class="form-control" placeholder="100000" value="100000 ">
				</div>

			</div>

		</div>

		<div class="form-group ">
			<label class="col-sm-2 control-label ">URL</label>
			<div class="col-sm-9 ">
				<input id="url" name="url" type="text" class="form-control" placeholder="127.0.0.1:6379">
			</div>
		</div>

		<div class="form-group ">
			<label class="col-sm-2 control-label ">Uid</label>
			<div class="col-sm-9 ">
				<input id="uid" name="uid" type="text" class="form-control" placeholder="dzdz/oracle@dzdz ">
			</div>
		</div>
		<div class="form-group ">
			<label class="col-sm-2 control-label ">SQL</label>
			<div class="col-sm-9 ">
				<textarea id="sql" name="sql" class="form-control" style="resize:vertical" rows="3" placeholder="select /*+ parallel(t,8) */ '01:'||fpdm||fphm key,kprq, skm, gfmc, gfsbh, gfdzdh, gfyhzh, xfmc, xfsbh, xfdzdh, xfyhzh, je, se, jshj, bz, skr, fhr, kpr, jqbh, kpjh,trunc((sysdate-kprq)*1440*60) expire from dzdz_fpxx_zzsfp "></textarea>
			</div>
		</div>
		<div class="form-group ">
			<label class="col-sm-2 control-label ">Fields</label>
			<div class="col-sm-9 ">
				<textarea id="fields" name="fields" type="text" class="form-control" style="resize:vertical" rows="2" placeholder="key,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,expire "></textarea>
			</div>
		</div>
		<div id="batch" class="form-group" hidden="hidden ">
			<label class="col-sm-2 control-label ">Batch</label>
			<div class="col-sm-9 ">
				<input id="batch" name="batch" type="text" class="form-control" placeholder="100000" value="100000 ">
			</div>
		</div>
		<div class="form-group ">
			<label class="col-sm-2 control-label ">Code Page</label>
			<div class="col-sm-9 ">
				<select id="codepage" name="codepage" class="selectpicker show-tick form-control" data-size="5 ">
					<option id="c01" name="c01" value="gbk ">GBK</option>
					<option id="c02" name="c02" value="utf8 ">UTF8</option>
				</select>
			</div>
		</div>
		<div id="log" class="form-group ">
			<label class="col-sm-2 control-label ">Log</label>
			<div class="col-sm-9 ">
				<div class="input-group ">
					<input id="log" name="log" type="text" class="form-control" value={{.log}} readonly>
					<span class="input-group-btn ">
						<button type="submit" class="btn btn-primary" onclick="checkInput();return false; "> 加载</button>
					</span>
				</div>
			</div>
		</div>
		<div class="form-group ">
			<label class="col-sm-2 control-label ">加载进度</label>
			<div class=" col-sm-9 ">
				<div id="console-wrap" style=" background-color: darkgreen; color: white; margin-top: 0px; border-radius: 4px; padding: 10px; overflow-y: auto; ">
					<!--style="max-height: 400px; background-color: darkgreen; color: white; margin-top: 0px; border-radius: 4px; padding: 10px; overflow-y: auto; ">-->
				<pre id="console" style="background-color: transparent; border: none; border-radius: 0; padding: 0; color: white; "></pre>
				<div id="waiting "></div>
			</div>
		</div>
	</div>
	<div class="form-group ">
		<label id="warn" class="col-sm-2 control-label" style="display: none; "> &nbsp;</label>
		<div class="col-sm-9 ">
			<div id="alert" class="alert alert-danger" role="alert" style="display: none; width: 100%; "></div>
		</div>
	</div>
</div>
</div>